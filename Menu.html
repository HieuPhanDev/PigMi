<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Menu</title>
    <link rel="shortcut icon" type="image/png" href="./img/Logo/Logo1.png" />
    <link rel="stylesheet" href="./bootstrap-5.2.3-dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./bootstrap-5.2.3-dist/css/bootstrap-grid.min.css" />
    <link rel="stylesheet" href="./css/Menu.css" />
    <link rel="stylesheet" href="./fontawesome-free-6.4.2-web/css/all.min.css" />
    <!-- <script src="./bootstrap-5.2.3-dist/js/bootstrap.bundle.js"></script> -->
    <script src="./bootstrap-5.2.3-dist/js/bootstrap.min.js"></script>
    <script src="./js/jquery-3.4.1.min.js"></script>
    <script src="./js/index.js"></script>
  </head>

  <body>
    <div class="header position-sticky sticky-top">
      <div class="container">
        <div class="row">
          <div class="col-md-2 col-sm-4 col-4 px-0 center">
            <img src="./img/Logo/logo2.png" class="img-fluid_2_2" alt="Logo" />
          </div>
          <div class="col-md-4 col-sm-8 col-8 py-3">
            <div class="input-group mb-3">
              <input
                type="text"
                class="form-control"
                placeholder="Từ khóa tìm kiếm"
                aria-label="Từ khóa tìm kiếm"
                aria-describedby="basic-addon2"
                id="timkiem"
              />
              <button class="input-group-text" id="basic-addon2" onclick="timkiemts()">
                <i class="fa-solid fa-magnifying-glass"></i>
              </button>
            </div>
          </div>
          <div class="col-md-4 col-sm-8 col-8 py-3 px-0">
            <div class="row">
              <div class="col">
                <div class="row">
                  <div class="col-md-4">
                    <div class="fs-3 text-info">
                      <i class="fa-solid fa-phone"></i>
                    </div>
                  </div>
                  <div class="col-md-8 px-0">
                    Hotline<br />
                    <strong class="text-info">03358585076</strong>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="row">
                  <div class="col-md-4">
                    <div class="fs-3 text-info">
                      <a href="dangnhap.html" id="taikhoan">
                        <i class="fa-regular fa-circle-user"></i>
                      </a>
                    </div>
                  </div>
                  <div class="col-md-8 px-0">
                    Xin chào!<br />
                    <a href="dangnhap.html" id="taikhoan" class="text-decoration-none">
                      <strong class="text-info" id="Dangnhap">Đăng nhập</strong>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-4 col-4 py-3">
            <div class="row">
              <div class="col-md-6 col-6">
                <a href="#" class="fs-2 position-relative">
                  <i class="fa-regular fa-heart"></i>
                </a>
              </div>
              <div class="col-md-6 col-6">
                <a
                  href="#"
                  class="fs-2 position-relative"
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#"
                  id="giohang"
                  onclick="ttgiohang()"
                >
                  <i class="fa-solid fa-bag-shopping"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="nav">
        <div class="container">
          <div class="row">
            <div class="col-md-12 px-0">
              <nav class="navbar navbar-expand-lg bg-body-tertiary">
                <div class="container-fluid px-0">
                  <a class="navbar-brand d-none" href="#">Navbar</a>
                  <button
                    class="navbar-toggler"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
                  >
                    <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                      <li class="nav-item px-4 py-2">
                        <a class="nav-link" aria-current="page" href="index.html">Trang chủ</a>
                      </li>
                      <li class="nav-item px-4 py-2" aria-current="page" href="#">
                        <a class="nav-link" href="Info.html">Giới thiệu</a>
                      </li>
                      <li class="nav-item dropdown btn-group px-4 py-2 active">
                        <a class="nav-link" href="Menu.html" role="button"> Menu </a>
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"></a>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="#Thucuong">Thức uống</a></li>
                          <li><a class="dropdown-item" href="#doannhe">Bánh ngọt</a></li>
                        </ul>
                      </li>
                      <li class="nav-item px-4 py-2" aria-current="page" href="#">
                        <a class="nav-link" href="News.html">Tin tức</a>
                      </li>
                      <li class="nav-item px-4 py-2" aria-current="page" href="#">
                        <a class="nav-link" href="contact.html">Liên hệ</a>
                      </li>
                    </ul>
                    <div class="socnet">
                      <li class="nav-item px-4 py-2">
                        <span class="fs-2 px-1">
                          <i class="fa-brands fa-instagram" style="color: #e21d9a"></i>
                        </span>
                        <span class="fs-2 px-1">
                          <i class="fa-brands fa-facebook" style="color: #1f93d6"></i>
                        </span>
                        <span class="fs-2 px-1">
                          <i class="fa-brands fa-tiktok"></i>
                        </span>
                      </li>
                    </div>
                  </div>
                </div>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="content">
      <div class="container">
        <div class="content-product1" id="Thucuong">
          <div class="cate-list mb-3">
            <div class="row"></div>
          </div>
          <div class="product-list mb-3">
            <div class="product-title">
              <div class="row">
                <div class="col-md-12">
                  <p class="bg-success p-2 text-white bg-opacity-75 h1">Trà sữa</p>
                </div>
              </div>
            </div>
            <div class="product-list-s py-3">
              <div class="row">
                <div class="col-md-4 col-6 mb-3 card" data-id="1">
                  <img src="./img/Menu/PigTea/01 (7).JPG" alt="Trà sữa hoàng kim" class="img-thumbnail my-1" />
                  <p class="h5">Trà Sữa Kem Chesse</p>
                  <p class="h4">25.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
                <div class="col-md-4 col-6 mb-3 card" data-id="2">
                  <img src="./img/Menu/PigTea/01 (11).JPG" alt="Trà Sữa Chocolate" class="img-thumbnail my-1" />
                  <p class="h5">Trà Sữa Chocolate</p>
                  <p class="h4">30.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
                <div class="col-md-4 col-6 mb-3 card" data-id="3">
                  <img
                    src="./img/Menu/PigTea/Trà Sữa Đặc Biệt.jpg"
                    alt="Trà Sữa Oolong 3J"
                    class="img-thumbnail my-1"
                  />
                  <p class="h5">Trà Sữa Full Topping</p>
                  <p class="h4">35.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
                <div class="col-md-4 col-6 mb-3 card" data-id="4">
                  <img src="./img/Menu/PigTea/01 (11).JPG" alt="Trà Sữa Hokkaido" class="img-thumbnail my-1" />
                  <p class="h5">Trà Sữa Đường Đen</p>
                  <p class="h4">25.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
                <div class="col-md-4 col-6 mb-3 card" data-id="5">
                  <img src="./img/Menu/PigTea/01 (8).JPG" alt="Trà Sữa Sương Sáo" class="img-thumbnail my-1" />
                  <p class="h5">Trà Đào Sang Chảnh</p>
                  <p class="h4">25.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
                <div class="col-md-4 col-6 mb-3 card" data-id="6">
                  <img
                    src="./img/Menu/PigTea/01 (9).JPG"
                    alt="Trà Sữa Trân Châu Hoàng Kim"
                    class="img-thumbnail my-1"
                  />
                  <p class="h5">Trà Dưa Lưới Hoàng Kim</p>
                  <p class="h4">35.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="content-product5" id="doannhe">
          <div class="cate-list mb-3">
            <div class="row"></div>
          </div>
          <div class="product-list mb-3">
            <div class="product-title">
              <div class="row">
                <div class="col-md-12">
                  <p class="bg-success p-2 text-white bg-opacity-75 h1">Đồ ăn nhẹ</p>
                </div>
              </div>
            </div>
            <div class="product-list-s py-3">
              <div class="row">
                <div class="col-md-4 col-6 mb-3 card" data-id="7">
                  <img src="./img/Menu/Banh/BanhMi.png" alt="Bánh mì" class="img-thumbnail my-1" />
                  <p class="h5">Bánh mì Pig Tea</p>
                  <p class="h4">30.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
                <div class="col-md-4 col-6 mb-3 card" data-id="8">
                  <img
                    src="./img/Menu/Banh/ButterChocolateCroissant.jpg"
                    alt="Butter Chocolate Croissant"
                    class="img-thumbnail my-1"
                  />
                  <p class="h5">Butter Chocolate Croissant</p>
                  <p class="h4">25.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
                <div class="col-md-4 col-6 mb-3 card" data-id="9">
                  <img
                    src="./img/Menu/Banh/GreenTeaChocoCake.png"
                    alt="Green Tea Choco Cake"
                    class="img-thumbnail my-1"
                  />
                  <p class="h5">GreenTea Choco Cake</p>
                  <p class="h4">30.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
                <div class="col-md-4 col-6 mb-3 card" data-id="10">
                  <img
                    src="./img/Menu/Banh/PassionPannaCotta.png"
                    alt="Passion Panna Cotta"
                    class="img-thumbnail my-1"
                  />
                  <p class="h5">Passion Panna Cotta</p>
                  <p class="h4">25.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
                <div class="col-md-4 col-6 mb-3 card" data-id="11">
                  <img
                    src="./img/Menu/Banh/PureButterCroissant.jpg"
                    alt="Pure Butter Croissant"
                    class="img-thumbnail my-1"
                  />
                  <p class="h5">Pure Butter Croissant</p>
                  <p class="h4">25.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
                <div class="col-md-4 col-6 mb-3 card" data-id="12">
                  <img src="./img/Menu/Banh/TiramisuMini.png" alt="Tiramisu Mini" class="img-thumbnail my-1" />
                  <p class="h5">Tiramisu Mini</p>
                  <p class="h4">45.000 (VNĐ)</p>
                  <button class="btn btn-outline-success my-2">Thêm vào giỏ hàng</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer">
      <div class="row">
        <div class="col-12 p-2">
          <p class="h2">Pig Tea - Pick Me</p>
          <p></p>
        </div>
      </div>
    </div>
    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Giỏ hàng</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <table class="table table-bordered">
              <tr>
                <th>Sản phẩm</th>
                <th>Đơn giá</th>
                <th>Số lượng</th>
                <th>Thành tiền</th>
                <th>Xóa</th>
              </tr>
              <tbody class="cart-items"></tbody>

              <tr>
                <td colspan="3" class="h5">Tổng thanh toán</td>
                <td id="totalAmount" colspan="2"></td>
              </tr>
            </table>
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" type="button" onclick="dathang()">Đặt hàng</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      class CartItem {
        constructor(name, price, totalPrice) {
          this.name = name
          this.price = price
          this.quantity = 1
          this.totalPrice = totalPrice
        }
      }
      class LocalCart {
        static key = 'cartItems'
        static getLocalCartItems() {
          let cartMap = new Map()
          const cart = localStorage.getItem(LocalCart.key)
          if (cart === null || cart.length === 0) return cartMap
          return new Map(Object.entries(JSON.parse(cart)))
        }

        static addItemToLocalCart(id, item) {
          let cart = LocalCart.getLocalCartItems()
          if (cart.has(id)) {
            let mapItem = cart.get(id)
            mapItem.quantity += 1
            cart.set(id, mapItem)
          } else cart.set(id, item)
          localStorage.setItem(LocalCart.key, JSON.stringify(Object.fromEntries(cart)))
          updateCartUI()
        }

        static removeItemFromCart(id) {
          let cart = LocalCart.getLocalCartItems()
          if (cart.has(id)) {
            let mapItem = cart.get(id)
            if (mapItem.quantity > 1) {
              mapItem.quantity -= 1
              cart.set(id, mapItem)
            } else cart.delete(id)
          }
          if (cart.length === 0) localStorage.removeItem('cartItems')
          else localStorage.setItem(LocalCart.key, JSON.stringify(Object.fromEntries(cart)))
          updateCartUI()
        }
      }
      const wholeCartWindow = document.querySelector('#cartModal')
      wholeCartWindow.inWindow = 0
      const addToCartBtns = document.querySelectorAll('button.btn.btn-outline-success.my-2')
      addToCartBtns.forEach((btn) => {
        btn.addEventListener('click', addItemFunction)
      })
      function addItemFunction(e) {
        const id = e.target.parentElement.getAttribute('data-id')
        const name = e.target.parentElement.children[1].textContent
        let price = e.target.parentElement.children[2].textContent
        const item = new CartItem(name, price)
        LocalCart.addItemToLocalCart(id, item)
      }
      function updateCartUI() {
        const cartWrapper = document.querySelector('.cart-items')
        cartWrapper.innerHTML = ''
        const items = LocalCart.getLocalCartItems()
        if (items === null) return
        let count = 0
        let total = 0
        var sum = 0
        for (const [key, value] of items.entries()) {
          const cartItem = document.createElement('tr')
          count += 1
          const price = +value.price.split(' ')[0].replace('.', '')
          total = price * +value.quantity
          sum += total
          total = Number(total).toLocaleString('vi-VN') + ' VNĐ'
          cartItem.innerHTML = `
                  <td>
                    <p class="fs-5 my-3">${value.name}</p>
                  </td>
                  <td>
                    <p class="my-3 gia">${value.price}</p>
                  </td>
                  <td class="py-4" style="display: flex; align-items: center; ">
                      <div name="" class="soluong px-4" onblur="calculateTotal(this)" >${value.quantity}</div>
                  </td>
                  <td>
                    <p class="my-3 thanhtien">${total}</p>
                  </td>
                  <td>
                    <i class="fas fa-window-close cancel fs-3" style="color: #FF0000"></i>
                  </td>

        `
          cartItem.querySelector('.cancel').addEventListener('click', () => {
            LocalCart.removeItemFromCart(key)
          })
          document.querySelector('#totalAmount').textContent = Number(sum).toLocaleString('vi-VN') + ' VNĐ'
          cartWrapper.append(cartItem)
        }
        const cartIcon = document.querySelector('.fa-solid.fa-bag-shopping')

        if (count > 0) {
          cartIcon.classList.add('non-empty')
          let root = document.querySelector(':root')
          root.style.setProperty('--after-content', `"${count}"`)
        } else {
          cartIcon.classList.remove('non-empty')
          document.querySelector('#totalAmount').textContent = Number(sum).toLocaleString('vi-VN') + ' VNĐ'
        }
      }
      document.addEventListener('DOMContentLoaded', () => {
        updateCartUI()
      })

      const name = localStorage.getItem('NameTT')

      var nameArray = name.split(' ')
      var firstName = nameArray[nameArray.length - 1]

      const TTDN = localStorage.getItem('trangthaiDN')
      if (TTDN == 'True') {
        document.getElementById('Dangnhap').textContent = firstName
        const taikhoan = document.querySelectorAll('#taikhoan')
        taikhoan.forEach((element) => {
          element.href = 'thongtin.html'
        })
        var cart = document.querySelector('#giohang')
        cart.setAttribute('data-bs-target', '#cartModal')
      }

      // function calculateTotal(input) {
      //   var giaElement = input.parentElement.previousElementSibling.querySelector('.gia')
      //   var thanhtienElement = input.parentElement.nextElementSibling.querySelector('.thanhtien')

      //   var gia = parseFloat(giaElement.textContent.replace(/[^\d]/g, ''))
      //   var soluong = input.value
      //   if (isNaN(soluong) || soluong <= 0) {
      //     removeCartItem()
      //   }
      //   var thanhtienValue = gia * soluong
      //   var thanhtienFormatted = thanhtienValue.toLocaleString()
      //   thanhtienElement.textContent = thanhtienFormatted + ' VNĐ'
      //   var totalAmount = calculateTotalAmount()
      //   document.getElementById('totalAmount').textContent = totalAmount.toLocaleString() + ' VNĐ'
      // }

      // function calculateTotalAmount() {
      //   var totalAmount = 0
      //   document.querySelectorAll('.soluong').forEach(function (input) {
      //     var giaElement = input.parentElement.previousElementSibling.querySelector('.gia')
      //     var soluong = input.value
      //     var gia = parseFloat(giaElement.textContent.replace(/[^\d]/g, ''))
      //     var subtotal = gia * soluong
      //     totalAmount += subtotal
      //   })
      //   return totalAmount
      // }

      // document.querySelectorAll('.soluong').forEach(function (input) {
      //   calculateTotal(input)
      // })
      // document.querySelectorAll('.soluong').forEach(function (input) {
      //   input.addEventListener('input', function () {
      //     calculateTotal(input)
      //   })
      // })

      function dathang() {
        window.location.href = 'thanhtoan.html'
      }

      function ttgiohang() {
        var cart = document.querySelector('#giohang')
        ttgh = cart.getAttribute('data-bs-target')
        if (ttgh == '#') {
          alert('Vui lòng đăng nhập để sử dụng tính năng!!!')
        }
      }
    </script>
  </body>
</html>
